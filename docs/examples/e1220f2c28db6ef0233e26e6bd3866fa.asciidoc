// This file is autogenerated, DO NOT EDIT
// aggregations/metrics/tophits-aggregation.asciidoc:427

[source, python]
----
resp = client.search(
    index="sales",
    size="0",
    aggs={
        "top_tags": {
            "terms": {
                "field": "type",
                "size": 3
            },
            "aggs": {
                "top_sales_hits": {
                    "top_hits": {
                        "sort": [
                            {
                                "date": {
                                    "order": "desc"
                                }
                            }
                        ],
                        "_source": {
                            "includes": [
                                "date",
                                "price"
                            ]
                        },
                        "size": 1
                    }
                },
                "having.top_salary": {
                    "bucket_selector": {
                        "buckets_path": {
                            "tp": "top_sales_hits[_source.price]"
                        },
                        "script": "params.tp < 180"
                    }
                }
            }
        }
    },
)
print(resp)
----
