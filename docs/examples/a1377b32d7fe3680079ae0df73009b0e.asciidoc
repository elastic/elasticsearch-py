// This file is autogenerated, DO NOT EDIT
// aggregations/metrics/tophits-aggregation.asciidoc:293

[source, python]
----
resp = client.search(
    index="sales",
    query={
        "term": {
            "tags": "car"
        }
    },
    aggs={
        "by_sale": {
            "nested": {
                "path": "comments"
            },
            "aggs": {
                "by_user": {
                    "terms": {
                        "field": "comments.username",
                        "size": 1
                    },
                    "aggs": {
                        "by_nested": {
                            "top_hits": {}
                        }
                    }
                }
            }
        }
    },
)
print(resp)
----
